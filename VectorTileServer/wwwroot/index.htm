<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <title>WebGL</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
        }
    </style>

    <link rel="stylesheet" href="libs/leaflet/leaflet.css" />
    <script src="libs/leaflet/leaflet.js"></script>

    <link href="libs/mapbox/mapbox-gl.css" rel='stylesheet' />
    <script src="libs/mapbox/mapbox-gl.js"></script>
    <script src="libs/mapbox/mapbox-gl-language.js"></script>
    <script src="libs/leaflet/leaflet-mapbox-gl.js"></script>

</head>

<body>
    <div id="map"></div>


    <script>

        var latitude = 43.725359;
        var longitude = 7.418737;

        var map = L.map('map').setView([latitude, longitude], 15);
        
        var gl = L.mapboxGL( // 'https://localhost:44378/{x}/{y}/{z}',
            {
                accessToken: 'no-token',
                // updateInterval: https://github.com/mapbox/mapbox-gl-leaflet/issues/55
                updateInterval: 5, // per 200 ms
                attribution: '<a target="blank" href="https://github.com/ststeiger/VectorTileServer ">Steiger&apos;s public vector tile server</a> | <a target="blank" href="https://openmaptiles.org ">OpenMapTiles</a> | Map data &copy; <a target="blank" href="http://openstreetmap.org/copyright">OpenStreetMap contributors</a>',
                //style: 'https://raw.githubusercontent.com/osm2vectortiles/mapbox-gl-styles/master/styles/bright-v9-cdn.json'
                "style": "https://localhost:44378/styles/bright/style.json"
            }
        ).addTo(map);

        gl._glMap.on('load', function () 
        {
            var keys = Object.keys(gl._glMap.style._layers);

            for (var i = 0; i < keys.length; ++i) 
            {
                if (((gl._glMap.style._layers[keys[i]].layout || {})._values || {})["text-field"]) 
                {
                    if (gl._glMap.style._layers[keys[i]].layout._values["text-field"].value.value.indexOf("name:") != -1) 
                    {
                        gl._glMap.setLayoutProperty(keys[i], 'text-field', ["coalesce", ["get", "name:ru"], ["get", "name:latin"], ["get", "name:nonlatin"]]);
                    }
                    
                }
                
            } // Next i 
            
        });

        var mapBounds = L.latLngBounds([
            [43.71, 7.349],
            [43.77, 7.491]
        ]);
        
        L.marker([latitude, longitude])
            .bindPopup("Hello <b>Leaflet GL</b>!<br>Whoa, it works!")
            .addTo(map)
            .openPopup();

        map.on('click', function (e)
        {
            var coord = e.latlng;
            var lat = coord.lat;
            var lng = coord.lng;
            console.log("You clicked the map at latitude: " + lat + " and longitude: " + lng);
        });

    </script>
</body>
</html>
